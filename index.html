<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Stock Market Update Bot</title>
    <!-- Font Awesome 6 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- TradingView Lightweight Charts -->
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
    <style>
        :root {
            --bg-base: #000000;
            --bg-surface: #0d0d0d;
            --bg-panel: #171717;
            --border-primary: #2d2d2d;
            --text-main: #ececec;
            --text-dim: #888888;
            --accent-green: #10a37f;
            --accent-red: #d94e4e;
            --accent-amber: #d97706;
            --shadow-premium: 0 20px 50px rgba(0,0,0,0.8);
        }

        * {
            margin: 0; padding: 0; box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: var(--bg-base);
            min-height: 100vh;
            display: flex; justify-content: center; align-items: center;
            color: var(--text-main);
            padding: 10px;
        }

        .app {
            width: 100%; max-width: 500px; height: 92vh;
            background: var(--bg-surface);
            border-radius: 32px;
            display: flex; flex-direction: column;
            overflow: hidden;
            border: 1px solid var(--border-primary);
            box-shadow: var(--shadow-premium);
            position: relative;
        }

        .header {
            padding: 24px 24px 16px;
            display: flex; align-items: center; justify-content: space-between;
            background: var(--bg-surface);
            z-index: 10;
        }

        .header h1 { font-size: 1.25rem; font-weight: 700; color: #fff; }

        .menu-btn {
            width: 44px; height: 44px;
            display: flex; align-items: center; justify-content: center;
            border-radius: 14px; background: var(--bg-panel);
            border: 1px solid var(--border-primary);
            cursor: pointer;
        }

        .chat-area {
            flex: 1; padding: 0 20px;
            overflow-y: auto; display: flex; flex-direction: column; gap: 20px;
            padding-bottom: 20px;
        }
        .chat-area::-webkit-scrollbar { width: 0; }

        .message { display: flex; flex-direction: column; animation: slideUp 0.4s ease-out; position: relative; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .message.bot { align-items: flex-start; }
        .message.user { align-items: flex-end; }

        .bubble {
            max-width: 95%; padding: 16px 20px;
            border-radius: 24px; font-size: 0.95rem; line-height: 1.6;
        }

        .bot .bubble { background: var(--bg-panel); color: var(--text-main); border: 1px solid var(--border-primary); border-bottom-left-radius: 4px; }
        .user .bubble { background: #fff; color: #000; font-weight: 500; border-bottom-right-radius: 4px; }

        .analysis-card { width: 100%; background: #0a0a0a; border-radius: 20px; padding: 15px; border: 1px solid var(--border-primary); margin-top: 10px; position: relative; }
        .card-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #1a1a1a; }
        .card-row:last-child { border: 0; }
        .label { color: var(--text-dim); font-size: 0.8rem; }
        .value { font-weight: 600; font-size: 0.85rem; }

        .signal-pill { padding: 4px 12px; border-radius: 8px; font-size: 0.75rem; font-weight: 800; text-transform: uppercase; }
        .buy { background: rgba(16, 163, 127, 0.15); color: var(--accent-green); }
        .sell { background: rgba(217, 78, 78, 0.15); color: var(--accent-red); }
        .hold { background: rgba(217, 119, 6, 0.15); color: var(--accent-amber); }

        .card-share-btn {
            position: absolute; top: 15px; right: 15px;
            color: var(--text-dim); cursor: pointer; font-size: 1rem;
            transition: color 0.2s;
            padding: 5px;
        }
        .card-share-btn:hover { color: #fff; }

        .chip-container { display: flex; gap: 8px; overflow-x: auto; padding: 0 20px 15px; }
        .chip { white-space: nowrap; padding: 8px 16px; background: var(--bg-panel); border: 1px solid var(--border-primary); border-radius: 100px; font-size: 0.8rem; font-weight: 600; color: var(--text-dim); cursor: pointer; }

        .input-wrapper { padding: 16px 20px 10px; background: var(--bg-surface); border-top: 1px solid var(--border-primary); z-index: 5; }
        .input-box { background: var(--bg-panel); border: 1px solid var(--border-primary); border-radius: 100px; padding: 6px 6px 6px 20px; display: flex; align-items: center; gap: 10px; }
        .input-box input { flex: 1; background: transparent; border: none; color: #fff; font-size: 1rem; outline: none; }
        .send-btn { width: 44px; height: 44px; background: #fff; border-radius: 50%; display: flex; align-items: center; justify-content: center; border: none; cursor: pointer; }

        .ad-footer {
            width: 100%; 
            height: 110px;
            background: #111;
            border-top: 1px solid var(--border-primary);
            position: relative; cursor: pointer;
            overflow: hidden;
        }
        .ad-footer img { width: 100%; height: 100%; object-fit: cover; object-position: center; }
        .close-ad { position: absolute; top: 8px; right: 12px; color: #fff; background: rgba(0,0,0,0.6); width: 26px; height: 26px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.85rem; z-index: 20; }

        .sidebar { position: absolute; top: 0; left: -100%; width: 80%; height: 100%; background: var(--bg-surface); z-index: 100; transition: left 0.3s ease; padding: 40px 24px; border-right: 1px solid var(--border-primary); }
        .sidebar.open { left: 0; }
        .sidebar-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 90; display: none; }

        .sidebar-item {
            padding: 16px;
            border-radius: 16px;
            background: var(--bg-panel);
            border: 1px solid var(--border-primary);
            color: #fff;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
        }
        .sidebar-item:active { transform: scale(0.98); }
        .sidebar-item i { width: 20px; text-align: center; color: var(--accent-green); }

        #toast {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            background: #ffffff; color: #000; padding: 14px 28px; border-radius: 100px;
            font-weight: 700; font-size: 0.9rem; z-index: 1000; display: none;
            box-shadow: 0 15px 40px rgba(0,0,0,0.6);
            animation: popUp 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes popUp { from { transform: translateX(-50%) translateY(20px); opacity: 0; } to { transform: translateX(-50%) translateY(0); opacity: 1; } }
    </style>
</head>
<body>

<div id="toast">Copied to Clipboard!</div>

<div class="app">
    <div class="sidebar-overlay" id="overlay"></div>
    <div class="sidebar" id="sidebar">
        <div style="display:flex; justify-content:space-between; margin-bottom:40px;">
            <h2 style="font-size:1.2rem;">Terminal Options</h2>
            <i class="fas fa-times" id="closeMenu" style="cursor:pointer;"></i>
        </div>
        
        <div class="sidebar-item" id="followDev">
            <i class="fab fa-instagram"></i> Follow Developer
        </div>
        <div class="sidebar-item" id="shareBtn">
            <i class="fas fa-share-nodes"></i> Share To Friends
        </div>
    </div>

    <header class="header">
        <h1>Market Bot <span style="color:var(--accent-green)">‚óè</span></h1>
        <div class="menu-btn" id="menuBtn"><i class="fas fa-bars-staggered" style="color:#888;"></i></div>
    </header>

    <div class="chat-area" id="chat">
        <div class="message bot">
            <div class="bubble">Welcome to Market Terminal. Enter an NSE ticker symbol (e.g., RELIANCE) to receive real-time signals and data.</div>
        </div>
    </div>

    <div class="chip-container">
        <div class="chip" onclick="handleChip('RELIANCE')">RELIANCE</div>
        <div class="chip" onclick="handleChip('TCS')">TCS</div>
        <div class="chip" onclick="handleChip('ZOMATO')">ZOMATO</div>
    </div>

    <div class="input-wrapper">
        <div class="input-box">
            <input type="text" id="symbolInp" placeholder="Enter stock symbol..." autocomplete="off">
            <button class="send-btn" id="sendBtn"><i class="fas fa-arrow-up"></i></button>
        </div>
    </div>

    <div class="ad-footer" id="adFooter" onclick="window.open('https://glider-app.pages.dev', '_blank')">
        <div class="close-ad" id="closeAdBtn"><i class="fas fa-times"></i></div>
        <img src="https://i.ibb.co/YBYK4z7/banner.jpg" alt="Promotion" onerror="this.style.display='none'">
    </div>
</div>

<script>
    const API_BASE = "https://stockbot.fayascreator.workers.dev";
    const APP_LINK = "https://f4yaaas.github.io/stockbot";
    
    const chat = document.getElementById('chat');
    const input = document.getElementById('symbolInp');
    const sendBtn = document.getElementById('sendBtn');
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('overlay');
    const shareBtn = document.getElementById('shareBtn');
    const followDev = document.getElementById('followDev');
    const toast = document.getElementById('toast');

    document.getElementById('menuBtn').onclick = () => { sidebar.classList.add('open'); overlay.style.display = 'block'; };
    document.getElementById('closeMenu').onclick = () => { sidebar.classList.remove('open'); overlay.style.display = 'none'; };
    overlay.onclick = () => { sidebar.classList.remove('open'); overlay.style.display = 'none'; };
    document.getElementById('closeAdBtn').onclick = (e) => { e.stopPropagation(); document.getElementById('adFooter').style.display = 'none'; };

    // Follow Developer Direct Action
    followDev.onclick = () => window.open('https://instagram.com/fayas.creator', '_blank');

    async function shareContent(text) {
        // Appending website link directly to the share text
        const fullMessage = `${text}\n\nüîó Get Live Updates: ${APP_LINK}`;
        
        if (navigator.share) {
            try {
                await navigator.share({
                    title: 'Market Terminal Update',
                    text: fullMessage
                });
            } catch (err) { console.log("Sharing cancelled"); }
        } else {
            const el = document.createElement('textarea');
            el.value = fullMessage;
            document.body.appendChild(el);
            el.select();
            document.execCommand('copy');
            document.body.removeChild(el);
            showToast("Details Copied!");
        }
    }

    // Sidebar Share
    shareBtn.onclick = () => shareContent("üìà Check out this Market Terminal Bot! It gives real-time NSE stock signals instantly.");

    function showToast(msg = "Copied to Clipboard!") {
        toast.innerText = msg;
        toast.style.display = 'block';
        setTimeout(() => toast.style.display = 'none', 3000);
    }

    function handleChip(sym) { input.value = sym; processRequest(); }
    sendBtn.onclick = processRequest;
    input.onkeypress = (e) => { if(e.key === 'Enter') processRequest(); };

    function addMessage(html, type) {
        const div = document.createElement('div');
        div.className = `message ${type}`;
        div.innerHTML = `<div class="bubble">${html}</div>`;
        chat.appendChild(div);
        chat.scrollTop = chat.scrollHeight;
        return div;
    }

    async function processRequest() {
        const symbol = input.value.trim().toUpperCase();
        if(!symbol) return;
        
        addMessage(symbol, 'user');
        input.value = '';

        const loader = addMessage(`<i class="fas fa-circle-notch fa-spin"></i> Analyzing Market...`, 'bot');

        try {
            const res = await fetch(`${API_BASE}/?symbol=${encodeURIComponent(symbol)}`, {
                method: "GET",
                headers: { "Accept": "application/json" }
            });

            const data = await res.json();
            loader.remove();

            if (data.error) {
                addMessage(`‚ö†Ô∏è ${data.error}`, 'bot');
                return;
            }

            let sigClass = "hold";
            const sig = (data.signal || "").toLowerCase();
            if (sig.includes("buy")) sigClass = "buy";
            else if (sig.includes("sell")) sigClass = "sell";

            // Structured message for sharing including the stock details
            const shareText = `üìä *Market Update: ${data.symbol || symbol}*\nüí∞ Price: ‚Çπ${data.price}\nüìâ Change: ${data.change}\nüéØ Signal: ${data.signal}\n‚ö†Ô∏è Risk: ${data.risk}`;

            addMessage(`
                <div style="font-weight:700; margin-bottom:8px;">${data.symbol || symbol}</div>
                <div class="analysis-card">
                    <i class="fas fa-share-nodes card-share-btn" onclick="shareContent('${shareText.replace(/'/g, "\\'").replace(/\n/g, "\\n")}')"></i>
                    <div class="card-row"><span class="label">Last Price</span><span class="value">‚Çπ${data.price || 'N/A'}</span></div>
                    <div class="card-row"><span class="label">Day Change</span><span class="value" style="color:${parseFloat(data.change) >= 0 ? 'var(--accent-green)' : 'var(--accent-red)'}">${data.change || '0%'}</span></div>
                    <div class="card-row"><span class="label">High / Low</span><span class="value">H: ${data.dayHigh} | L: ${data.dayLow}</span></div>
                    <div class="card-row" style="border:0; margin-top:10px;">
                        <span class="signal-pill ${sigClass}">${data.signal || 'NEUTRAL'}</span>
                        <span style="font-size:0.7rem; color:var(--text-dim); margin-left:10px;">Risk: ${data.risk || 'Normal'}</span>
                    </div>
                    <div style="font-size:0.65rem; color:#444; margin-top:10px; text-align:right;">Updated: ${data.time || 'Live'}</div>
                </div>
            `, 'bot');

        } catch (err) {
            loader.remove();
            addMessage(`<span style="color:var(--accent-red)">Connection Error.</span><br><small>Unable to reach the market server.</small>`, 'bot');
            console.error(err);
        }
    }
</script>
</body>
</html>
